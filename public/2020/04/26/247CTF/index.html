<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>247CTF | 聊聊呗</title><meta name="description" content="247CTF"><meta name="author" content="喝点儿聊聊"><meta name="copyright" content="喝点儿聊聊"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/public/public/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="247CTF"><meta name="twitter:description" content="247CTF"><meta name="twitter:image" content="https://fromessence.github.io/public/public/img/post.jpg"><meta property="og:type" content="article"><meta property="og:title" content="247CTF"><meta property="og:url" content="https://fromessence.github.io/public/2020/04/26/247CTF/"><meta property="og:site_name" content="聊聊呗"><meta property="og:description" content="247CTF"><meta property="og:image" content="https://fromessence.github.io/public/public/img/post.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/public/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://fromessence.github.io/public/2020/04/26/247CTF/"><link rel="prev" title="TCP端口“共享”问题" href="https://fromessence.github.io/public/2020/05/03/TCP%E7%AB%AF%E5%8F%A3%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/"><link rel="next" title="决策树" href="https://fromessence.github.io/public/2020/04/11/%E5%86%B3%E7%AD%96%E6%A0%91/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/public/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/public/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/public/archives/"><div class="headline">Articles</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/public/tags/"><div class="headline">Tags</div><div class="length_num">2</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/public/categories/"><div class="headline">Categories</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/public/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/public/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/public/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/public/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/public/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/public/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/public/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/public/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#247CTF-简介"><span class="toc-number">1.</span> <span class="toc-text">247CTF 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Beginner"><span class="toc-number">2.</span> <span class="toc-text">Beginner</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-AND-TRICKS"><span class="toc-number">2.1.</span> <span class="toc-text">TIPS AND TRICKS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction"><span class="toc-number">2.1.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis"><span class="toc-number">2.1.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reference"><span class="toc-number">2.1.3.</span> <span class="toc-text">Reference</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Networking"><span class="toc-number">3.</span> <span class="toc-text">Networking</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ERROR-REPORTING-PROTOCOL"><span class="toc-number">3.1.</span> <span class="toc-text">ERROR REPORTING PROTOCOL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-1"><span class="toc-number">3.1.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-1"><span class="toc-number">3.1.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reference-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">Reference</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Not-my-Modulus"><span class="toc-number">3.2.</span> <span class="toc-text">Not my Modulus</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-2"><span class="toc-number">3.2.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Some-confusions-when-solving"><span class="toc-number">3.2.3.</span> <span class="toc-text">Some confusions when solving</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ref"><span class="toc-number">3.2.4.</span> <span class="toc-text">Ref</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multiplication-Tables"><span class="toc-number">3.3.</span> <span class="toc-text">Multiplication Tables</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-3"><span class="toc-number">3.3.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-3"><span class="toc-number">3.3.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Refs"><span class="toc-number">3.3.3.</span> <span class="toc-text">Refs:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Protocol"><span class="toc-number">3.4.</span> <span class="toc-text">Custom Protocol</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-number">4.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Trusted-Client"><span class="toc-number">4.1.</span> <span class="toc-text">Trusted Client</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-4"><span class="toc-number">4.1.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-4"><span class="toc-number">4.1.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ref-1"><span class="toc-number">4.1.3.</span> <span class="toc-text">Ref</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Secured-Session"><span class="toc-number">4.2.</span> <span class="toc-text">Secured Session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-5"><span class="toc-number">4.2.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-5"><span class="toc-number">4.2.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ref-2"><span class="toc-number">4.2.3.</span> <span class="toc-text">Ref</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compare-the-Pair"><span class="toc-number">4.3.</span> <span class="toc-text">Compare the Pair</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-6"><span class="toc-number">4.3.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-6"><span class="toc-number">4.3.2.</span> <span class="toc-text">Analysis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REF"><span class="toc-number">4.3.3.</span> <span class="toc-text">REF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-The-text-editor-jail"><span class="toc-number">5.1.</span> <span class="toc-text">1 .The text editor jail</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-7"><span class="toc-number">5.1.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-7"><span class="toc-number">5.1.2.</span> <span class="toc-text">Analysis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-An-impossible-number"><span class="toc-number">5.2.</span> <span class="toc-text">2. An impossible number</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instruction-8"><span class="toc-number">5.2.1.</span> <span class="toc-text">Instruction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Analysis-8"><span class="toc-number">5.2.2.</span> <span class="toc-text">Analysis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-The-Flag-Lottery"><span class="toc-number">5.3.</span> <span class="toc-text">3. The Flag Lottery</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ref-3"><span class="toc-number">5.3.1.</span> <span class="toc-text">Ref</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Hidden-Painting"><span class="toc-number">5.4.</span> <span class="toc-text">4. Hidden Painting</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/public/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/public/">聊聊呗</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/public/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/public/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/public/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/public/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/public/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/public/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/public/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/public/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">247CTF</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-04-26 18:40:02"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-04-26</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-05-30 16:45:49"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-05-30</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/public/categories/CTF/">CTF</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="247CTF-简介"><a href="#247CTF-简介" class="headerlink" title="247CTF 简介"></a>247CTF 简介</h2><ul>
<li><p>解题网站，题目独立，按类别分类</p>
</li>
<li><p>注册与登录需要调用<code>google</code>的验证码服务</p>
<p><img src="/public/" class="lazyload" data-src="/public/blog-imgs/247ctf_reg.png"  alt="register"></p>
</li>
</ul>
<h2 id="Beginner"><a href="#Beginner" class="headerlink" title="Beginner"></a>Beginner</h2><h3 id="TIPS-AND-TRICKS"><a href="#TIPS-AND-TRICKS" class="headerlink" title="TIPS AND TRICKS"></a>TIPS AND TRICKS</h3><h4 id="Instruction"><a href="#Instruction" class="headerlink" title="Instruction"></a>Instruction</h4><p>​    There’s a server listening on some tcp port. When a new connection comes in, it responces with a text containing a math addition problem. The client will receive the flag after it answers correctly for the whole 500 questions.</p>
<h4 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h4><p>​    It’s unrealistic to send answers by hand, so we should write a simple client which reads questions, computes answers and sends back, over and over again.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">host = <span class="string">'728d1bbe8df32a68.247ctf.com'</span></span><br><span class="line">port = <span class="number">50277</span></span><br><span class="line">s.connect((host, port))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">500</span>):</span><br><span class="line">    msg = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(msg)</span><br><span class="line">    ques = msg.decode(<span class="string">'utf-8'</span>).split(<span class="string">'\r\n'</span>)[<span class="number">-2</span>]</span><br><span class="line">    segs = ques.split(<span class="string">' '</span>)</span><br><span class="line">    a = int(segs[<span class="number">-3</span>])</span><br><span class="line">    b = int(segs[<span class="number">-1</span>][<span class="number">0</span>:<span class="number">-1</span>])</span><br><span class="line">    print(a+b)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># attention! '\r\n' should be added, simulating a person pressing enter key.</span></span><br><span class="line">    s.send((str(a+b)+<span class="string">'\r\n'</span>).encode(<span class="string">'utf-8'</span>)) </span><br><span class="line"></span><br><span class="line">flag = s.recv(<span class="number">1024</span>).decode()</span><br><span class="line">print(flag)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="https://www.bladewan.com/2017/10/01/python_socket/" target="_blank" rel="noopener">Python socket module</a></li>
</ul>
<h2 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h2><h3 id="ERROR-REPORTING-PROTOCOL"><a href="#ERROR-REPORTING-PROTOCOL" class="headerlink" title="ERROR REPORTING PROTOCOL"></a>ERROR REPORTING PROTOCOL</h3><h4 id="Instruction-1"><a href="#Instruction-1" class="headerlink" title="Instruction"></a>Instruction</h4><p>​    Download the tcpdump file and identify the flag hidden within the error messages of this ICMP traffic.</p>
<h4 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h4><ol>
<li><p>Find where and what the error is.<br> <img src="/public/" class="lazyload" data-src="/public/blog-imgs/247ctf/01.png"  alt="01"></p>
</li>
<li><p>Why error ?</p>
<p>In <code>echo(ping)</code>, <code>ICMP</code> uses <code>id</code> and <code>seq</code> to identify and match request and reply. Also, <code>ICMP</code> will try to match the <code>data</code> field between request and reply. Under default setting, those two data field are the same , as the name <code>echo</code> imply. So, if there is not a match for some req, it reports a warning.</p>
</li>
<li><p>What to do ? </p>
<p>Data in echo reply changed, so maybe some information is hidden in the payload. In Wireshark we can see the payload in echo request is “Send the flag !”, and payload in the first reply have “JFIF” in it, which means reply is an image.<br> <img src="/public/" class="lazyload" data-src="/public/blog-imgs/247ctf/02.png"  alt="02"><br> <img src="/public/" class="lazyload" data-src="/public/blog-imgs/247ctf/03.png"  alt="03"><br>Now we should concatenate all ICMP reply payloads to one file.</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="keyword">import</span> dpkt</span><br><span class="line"></span><br><span class="line">in_pcap=open(<span class="string">"error_reporting.pcap"</span>, <span class="string">"rb"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># going to extract all ICMP payloads and concatenate them in_pcap one file</span></span><br><span class="line">output=open(<span class="string">"output.jpg"</span>, <span class="string">"bw"</span>)</span><br><span class="line">pcap=dpkt.pcap.Reader(in_pcap)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The parsed packets in the dpkt.pcap.Reader contains two members: "ts" and "buf".</span></span><br><span class="line"><span class="comment"># The member "ts" is just the timestamp which lived in_pcap the packet when captured</span></span><br><span class="line"><span class="comment"># by Wireshark; it is the clock when captured this packet. The member "buf" holds</span></span><br><span class="line"><span class="comment"># the real packet data captured by capture tool, it's the raw traffic data.</span></span><br><span class="line"><span class="keyword">for</span> ts, buf <span class="keyword">in</span> pcap:</span><br><span class="line">    eth=dpkt.ethernet.Ethernet(buf)</span><br><span class="line">    <span class="keyword">if</span> (eth.type != <span class="number">2048</span>): <span class="comment"># 2048 is the code for IPv4</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    ip=eth.data</span><br><span class="line">    icmp=ip.data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ip.p==dpkt.ip.IP_PROTO_ICMP) <span class="keyword">and</span> len(icmp.data.data)&gt;<span class="number">0</span>:</span><br><span class="line">        output.write(icmp.data.data)</span><br><span class="line"></span><br><span class="line">in_pcap.close()</span><br><span class="line">output.close()</span><br></pre></td></tr></table></figure>

<p>Now we get the img and can see flag after opening it .</p>
<h4 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li>(<a href="https://docs.microsoft.com/zh-cn/windows/win32/api/icmpapi/nf-icmpapi-icmpsendecho?redirectedfrom=MSDN" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows/win32/api/icmpapi/nf-icmpapi-icmpsendecho?redirectedfrom=MSDN</a>)</li>
<li><a href="https://b4d.sablun.org/blog/2020-02-16-247ctf-com-networking-error-reporting-protocol/" target="_blank" rel="noopener">dpkt解题</a></li>
</ul>
<h3 id="Not-my-Modulus"><a href="#Not-my-Modulus" class="headerlink" title="Not my Modulus"></a>Not my Modulus</h3><h4 id="Instruction-2"><a href="#Instruction-2" class="headerlink" title="Instruction"></a>Instruction</h4><p>We are trying to decrypt a packet capture taken on our internal network. We know you can decrypt the data using the correct private key, but we simply have too many. Can you identify the correct key? (pcap file and many private keys provided.)</p>
<h4 id="Analysis-2"><a href="#Analysis-2" class="headerlink" title="Analysis"></a>Analysis</h4><ol>
<li><p>Where is the target data ?<br>Two stages in TLS have encrypted data. </p>
<table>
<thead>
<tr>
<th>stage</th>
<th>encrypted data</th>
<th>key</th>
</tr>
</thead>
<tbody><tr>
<td>application data transfer</td>
<td>application data</td>
<td>session key<br />(can’t be captured)</td>
</tr>
<tr>
<td>handshake</td>
<td>PreMaster secret<br />(for session key generating)</td>
<td>server public key</td>
</tr>
<tr>
<td>handshake</td>
<td>encrypted handshake message</td>
<td>session key</td>
</tr>
</tbody></table>
<p>I know flag can be in application data, but <code>not sure</code> if it can be hidden in handshake premaster or encrypted handshake msg. Fortunately, all three above can be decrypted cause we are provided the server private key.</p>
</li>
<li><p>how to decrypt ?</p>
<p>Premaster secret can be decrypted using correct private key, and what’s better is that wireshark can compute session keys as well given the private key.</p>
</li>
<li><p>how to match RSA key pairs ?</p>
<p>Modulus in private key and public key should be the same.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PUB_KEY_MODULUS=$(openssl x509 -inform der -in cert.der -noout -modulus | openssl md5 )</span><br><span class="line">echo $PUB_KEY_MODULUS</span><br><span class="line">for filename in keys/*; do</span><br><span class="line">    PRIVATE_KEY_MODULUS=$(openssl rsa -noout -modulus -in $filename | openssl md5)</span><br><span class="line">    if [ "$PUB_KEY_MODULUS" = "$PRIVATE_KEY_MODULUS" ]; then</span><br><span class="line">        echo</span><br><span class="line">        echo $filename</span><br><span class="line">    fi</span><br><span class="line">    break</span><br><span class="line">done</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p>how to decrypt packets in wireshark ?</p>
<p>Details in [8]. One thing important is that the<code>debug file</code> field is better not left empty. Even given wrong actual tls port, wireshark can print correct decrypted data in the debug file. </p>
<p><img src="/public/" class="lazyload" data-src="/public/blog-imgs/247ctf/tls_01.png"  alt="yu"></p>
</li>
</ol>
<h4 id="Some-confusions-when-solving"><a href="#Some-confusions-when-solving" class="headerlink" title="Some confusions when solving"></a>Some confusions when solving</h4><p>Q1: In the pcap file I see Encrypt Alert before TCP FIN, and if looking into it ,I see “Content Type: Alert(21)” in wireshark. When refering to RFC 5246, I see in section 7.2 Alert “decryption_failed_RESERVED(21)” . So why decryption failed in this pcap, what happened ?<br>A1: Actually I’ve mistaken the meaning of “Content Type: Alert(21)”. It means “The higher-level protocol used to process the enclosed fragment.”[3]. In other words, it says that part is an alert, but the alert is encrypted, so we can’t see the alert type.</p>
<h4 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h4><ol>
<li><a href="https://tools.ietf.org/html/rfc5246#page-57" target="_blank" rel="noopener">RFC 5246</a></li>
<li><a href="https://www.cloudflare.com/learning/ssl/what-happens-in-a-tls-handshake/" target="_blank" rel="noopener">TLS handshake</a></li>
<li><a href="https://superuser.com/questions/1029094/tls-and-alert-21-after-handshake/1029318" target="_blank" rel="noopener">Distinguish Content type and AlertDescription in TLS</a></li>
<li><a href="https://www.ibm.com/support/pages/how-verify-if-private-key-matches-certificate" target="_blank" rel="noopener">How to verify if a Private Key Matches a Certificate?</a></li>
<li><a href="https://commandlinefanatic.com/cgi-bin/showarticle.cgi?article=art054" target="_blank" rel="noopener">Matching a private key to a public key(ssl, ssh)</a></li>
<li><a href="https://support.ssl.com/Knowledgebase/Article/View/19/0/der-vs-crt-vs-cer-vs-pem-certificates-and-how-to-convert-them" target="_blank" rel="noopener">certificate format </a></li>
<li><a href="https://knowledge.digicert.com/solution/SO16899.html" target="_blank" rel="noopener"></a></li>
<li><a href="https://support.citrix.com/article/CTX116557" target="_blank" rel="noopener">how to decrypted tls in wireshark using private key</a></li>
<li><a href="https://b4d.sablun.org/blog/2020-04-04-247ctf-com-networking-not-my-modulus/" target="_blank" rel="noopener">writeup</a></li>
<li><a href="https://stackoverflow.com/questions/5244129/use-rsa-private-key-to-generate-public-key" target="_blank" rel="noopener">why can openssl generate given private key</a></li>
</ol>
<h3 id="Multiplication-Tables"><a href="#Multiplication-Tables" class="headerlink" title="Multiplication Tables"></a>Multiplication Tables</h3><h4 id="Instruction-3"><a href="#Instruction-3" class="headerlink" title="Instruction"></a>Instruction</h4><p>Can you recover the private key we used to download the flag over a TLS encrypted connection?</p>
<h4 id="Analysis-3"><a href="#Analysis-3" class="headerlink" title="Analysis"></a>Analysis</h4><p>What we can only do is to try to get the private key.<br>Already have:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) public key of server. (from certificate)</span><br></pre></td></tr></table></figure>

<p>Now think how to compute the private key…</p>
<p>here use tool[2], which get the private key in this problem by <code>Fermat Factorization</code>.</p>
<p>step 1 : get public key from certificate</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> openssl x509 -inform DER -<span class="keyword">in</span> cert.der -pubkey -noout &gt; key.pub</span></span><br></pre></td></tr></table></figure>

<p>step 2: install related package ——<code>pycryptodome</code></p>
<p>step 3 : cracking</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ python .&#x2F;RsaCtfTool-master&#x2F;RsaCtfTool.py --publickey key.pub --private --attack factordb</span><br><span class="line">[*] Testing key key.pub.</span><br><span class="line">[*] Performing factordb attack on key.pub.</span><br><span class="line"></span><br><span class="line">Results for key.pub:</span><br><span class="line"></span><br><span class="line">Private key :</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXQIBAAKBgQDVzrM58EOtSsBE5WgLJiNjPa&#x2F;hZtArVRS0PjS01u6DyAlvAWwm</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Then we can decrypt the TLS traffic. </p>
<h4 id="Refs"><a href="#Refs" class="headerlink" title="Refs:"></a>Refs:</h4><p>RSA algo</p>
<ol>
<li><a href="di-mgt.com.au/rsa_alg.html">best I ever see</a></li>
</ol>
<p>Decrypt RSA keys</p>
<ol start="2">
<li><a href="https://github.com/Ganapati/RsaCtfTool" target="_blank" rel="noopener">python tool</a></li>
<li><a href="https://mathworld.wolfram.com/FermatsFactorizationMethod.html" target="_blank" rel="noopener">Fermat Factorization</a></li>
</ol>
<h3 id="Custom-Protocol"><a href="#Custom-Protocol" class="headerlink" title="Custom Protocol"></a>Custom Protocol</h3><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="Trusted-Client"><a href="#Trusted-Client" class="headerlink" title="Trusted Client"></a>Trusted Client</h3><h4 id="Instruction-4"><a href="#Instruction-4" class="headerlink" title="Instruction"></a>Instruction</h4><p>Developers don’t always have time to setup a backend service when prototyping code. Storing credentials on the client side should be fine as long as it’s obfuscated right?</p>
<h4 id="Analysis-4"><a href="#Analysis-4" class="headerlink" title="Analysis"></a>Analysis</h4><ol>
<li>What info we can get now : </li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. "obfuscated" must imply something.</span><br><span class="line">2. We can see long strange characters in JS.</span><br><span class="line">3. Input any username and pass, an alert occurs. But see the JS, no "alert" is found. So there must be something executed in the strange JS. Actually the js  is obfuscated.</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Next we should know know what obfuscated algo used. After searching, we know it’s JSFuck.</p>
<p>So just find an online decoder<strong>(Be careful that the obfuscated js code you copy may have spaces, you should delete them by using regular expression and replace <code>\s</code> to <code>\0</code>)</strong>. en </p>
<p>Then we get the flag. </p>
</li>
</ol>
<h4 id="Ref-1"><a href="#Ref-1" class="headerlink" title="Ref"></a>Ref</h4><ol>
<li><a href="https://enkhee-osiris.github.io/Decoder-JSFuck/" target="_blank" rel="noopener">JSFuck decoder online</a></li>
</ol>
<h3 id="Secured-Session"><a href="#Secured-Session" class="headerlink" title="Secured Session"></a>Secured Session</h3><h4 id="Instruction-5"><a href="#Instruction-5" class="headerlink" title="Instruction"></a>Instruction</h4><p>If you can guess our random secret key, we will tell you the flag securely stored in your session</p>
<h4 id="Analysis-5"><a href="#Analysis-5" class="headerlink" title="Analysis"></a>Analysis</h4><p>What we know is that flag is in something called “session”. </p>
<p>Open the web, we are shown is server side code using  flask:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secret_key_to_int</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        secret_key = int(s)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        secret_key = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> secret_key</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/flag")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    secret_key = secret_key_to_int(request.args[<span class="string">'secret_key'</span>]) <span class="keyword">if</span> <span class="string">'secret_key'</span> <span class="keyword">in</span> request.args <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    session[<span class="string">'flag'</span>] = flag</span><br><span class="line">    <span class="keyword">if</span> secret_key == app.config[<span class="string">'SECRET_KEY'</span>]:</span><br><span class="line">      <span class="keyword">return</span> session[<span class="string">'flag'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"Incorrect secret key!"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">"</span> % open(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>The logic above is easy. Only if requesting <code>/flag</code> page with <code>?secret_key=</code> plus string same as <code>app.config[&#39;SECRET_KEY&#39;]</code> will the flag be returned . But no enough info we can’t guess the random number. </p>
<p>We note  that session in web related to cookie. , maybe flag is in the cookie. press <code>F12</code> there is no cookie set by this site. </p>
<p>But after trying to request page <code>/flag?secret_key=123</code>  we get a cookie. That is because <code>session</code> module set the <code>flag</code> into cookie. </p>
<p>Now what matters is the format of cookie. From [2] we learn cookie set by flask is <code>signed cookie</code>, which is <code>content+secure_hash(content, key)</code>. <code>signature</code>  ensures integrity so that an attacker can’t modify it. But, no confidentiality ensured so <strong><em>anyone can see</em></strong> the content.</p>
<p>encoded by base64 , we can decode it again by base64 and then get the flag. </p>
<p>code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># note I add a '=' at the end, cause '=' maybe omited .</span></span><br><span class="line"><span class="comment"># '=' has special defalt meaning in URL and cookie, so omited</span></span><br><span class="line">cookie_b64 = base64.b64decode(<span class="string">'eyJmbGFnIjp7IiBiIjoiTWpRM1ExUkdlMlJoT0RBM09UVm1PR0UxWTJGaU1tVXdNemRrTnpNNE5UZ3dOMkk1WVRreGZRPT0ifX0='</span>)</span><br><span class="line">print(base64.b64decode(cookie_b64))</span><br></pre></td></tr></table></figure>



<h4 id="Ref-2"><a href="#Ref-2" class="headerlink" title="Ref"></a>Ref</h4><ol>
<li><a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">flask cookie decode tool</a></li>
<li><a href="https://stackoverflow.com/questions/31341372/how-does-flask-get-the-value-back-from-session-cookies" target="_blank" rel="noopener">flask cookie format</a></li>
<li><a href="https://hackmd.io/@Chivato/rkj-Y1GVI" target="_blank" rel="noopener">writeup</a></li>
</ol>
<h3 id="Compare-the-Pair"><a href="#Compare-the-Pair" class="headerlink" title="Compare the Pair"></a>Compare the Pair</h3><h4 id="Instruction-6"><a href="#Instruction-6" class="headerlink" title="Instruction"></a>Instruction</h4><p>Can you identify a way to bypass our login logic? MD5 is supposed to be a one-way function rightiece</p>
<p>The web page is piece of authentication code .</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span>(<span class="string">'flag.php'</span>);</span><br><span class="line">  $password_hash = <span class="string">"0e902564435691274142490923013038"</span>;</span><br><span class="line">  $salt = <span class="string">"f789bbc328a3d1a3"</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'password'</span>]) &amp;&amp; md5($salt . $_GET[<span class="string">'password'</span>]) == $password_hash)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> highlight_file(<span class="keyword">__FILE__</span>, <span class="keyword">true</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Analysis-6"><a href="#Analysis-6" class="headerlink" title="Analysis"></a>Analysis</h4><p>The aim is to crack the md5 given salt value and hash value . </p>
<p>From [1] I know that there is a <strong>“php type juggling bug”</strong> . </p>
<blockquote>
<p>In php, loose comparison <code>==</code> will do type juggling . </p>
<p>1) When comparing a string to a number, PHP will attempt to convert the string to a number then perform a numeric comparison.</p>
<p>2)  If PHP decides that both operands look like numbers, even if they are actually strings, it will convert them both and perform a numeric comparison.</p>
</blockquote>
<p>Here, <code>md5</code> return a string, but note that <code>$password_hash</code> is a string of format <code>0e+nums</code> . So if we can find a string s satisfy : <code>md5(s+salt)</code> is also “0e+nums”, then php will compare them as numbers, which are all 0 </p>
<p>Exploit code[2]:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> hashlib <span class="comment"># Import the modules</span></span><br><span class="line"></span><br><span class="line">alphabet = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>): <span class="comment"># Iterate through the lengths</span></span><br><span class="line">    <span class="comment"># For each combination in this alphabet with this length</span></span><br><span class="line">        <span class="keyword">for</span> combo <span class="keyword">in</span> product(alphabet, repeat=x): </span><br><span class="line">                result = hashlib.md5(<span class="string">"f789bbc328a3d1a3"</span> + <span class="string">''</span>.join(combo)).hexdigest() </span><br><span class="line">                <span class="keyword">if</span> result.startswith(<span class="string">"0e"</span>) <span class="keyword">and</span> result[<span class="number">2</span>:].isdigit(): </span><br><span class="line">                        <span class="keyword">print</span> <span class="string">"f789bbc328a3d1a3"</span> + <span class="string">''</span>.join(combo) </span><br><span class="line">                        exit(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">pass</span> <span class="comment">#If not pass</span></span><br></pre></td></tr></table></figure>



<h4 id="REF"><a href="#REF" class="headerlink" title="REF"></a>REF</h4><ol>
<li><a href="https://b4d.sablun.org/blog/2020-02-25-247ctf-com-web-compare-the-pair/" target="_blank" rel="noopener">writeup</a></li>
<li><a href="https://hackmd.io/@Chivato/rkj-Y1GVI" target="_blank" rel="noopener">writeup2</a></li>
</ol>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="1-The-text-editor-jail"><a href="#1-The-text-editor-jail" class="headerlink" title="1 .The text editor jail"></a>1 .The text editor jail</h3><h4 id="Instruction-7"><a href="#Instruction-7" class="headerlink" title="Instruction"></a>Instruction</h4><p>We didn’t have time to setup and test a proper jail, so this text editor will have to do for now. Can you break free?</p>
<h4 id="Analysis-7"><a href="#Analysis-7" class="headerlink" title="Analysis"></a>Analysis</h4><p>Open the web page we are provided a Vim editor. Remember that <code>:! [command]</code>can be used to run command in Vim, we try :</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:! ls</span><br><span class="line">(see a executable file)</span><br><span class="line">:! ./[exe name]</span><br><span class="line">(get flag)</span><br></pre></td></tr></table></figure>

<h3 id="2-An-impossible-number"><a href="#2-An-impossible-number" class="headerlink" title="2. An impossible number"></a>2. An impossible number</h3><h4 id="Instruction-8"><a href="#Instruction-8" class="headerlink" title="Instruction"></a>Instruction</h4><p>Can you think of a number which at the same time is one more than itself?</p>
<h4 id="Analysis-8"><a href="#Analysis-8" class="headerlink" title="Analysis"></a>Analysis</h4><p>We are given a socket and a c source file:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> impossible_number;</span><br><span class="line">    FILE *flag;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;impossible_number)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (impossible_number &gt; <span class="number">0</span> &amp;&amp; impossible_number &gt; (impossible_number + <span class="number">1</span>)) &#123;</span><br><span class="line">            flag = fopen(<span class="string">"flag.txt"</span>,<span class="string">"r"</span>);</span><br><span class="line">            <span class="keyword">while</span>((c = getc(flag)) != EOF) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%c"</span>,c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s easy . 2^31-1 satisfy the requirement since plus one will overflow to be negative.</p>
<h3 id="3-The-Flag-Lottery"><a href="#3-The-Flag-Lottery" class="headerlink" title="3. The Flag Lottery"></a>3. The Flag Lottery</h3><p>The reason why random <code>winning_choice</code> can be guessed is that it is generated every time it  handles a request and the network condition is good enough. </p>
<p>According to <strong>[2]</strong>, </p>
<blockquote>
<p>The problem lies in incorrectly initialized random. We can simply initialize it in the same way (with a small added time delay of 1 sec) and get the correct solution.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">secret = random.Random()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="comment"># I got flag when i = 0</span></span><br><span class="line">    secret.seed(int(time.time())<span class="comment"># no need to add 1 second if network condition good.</span></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.connect((<span class="string">'63152a5c86af2e63.247ctf.com'</span>, <span class="number">50150</span>))</span><br><span class="line">    sock.recv(<span class="number">1024</span>)</span><br><span class="line">    guess = str(secret.random()).encode()</span><br><span class="line">    sock.sendall(guess)</span><br><span class="line">    res = str(sock.recv(<span class="number">1024</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'Nope'</span> <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">print</span> res </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> res</span><br><span class="line">    sock.close()</span><br></pre></td></tr></table></figure>



<p>Note that Python 2 should be used here cause different implementation between python 2 and 3 <strong>[1]</strong>. </p>
<p>Even in Python 3 itself, seed of type <code>str</code> is dealt with differently (can be set by parameter <code>version</code>)<strong>[3]</strong></p>
<h4 id="Ref-3"><a href="#Ref-3" class="headerlink" title="Ref"></a>Ref</h4><ol>
<li><p><a href="https://www.reddit.com/r/pythontips/comments/5pp5mz/the_random_module_with_the_same_seed_produces_a/" target="_blank" rel="noopener">Same seed produce differect random value in python 2 and 3</a></p>
</li>
<li><p><a href="https://f3real.github.io/247ctf_1.html#the-flag-lottery" target="_blank" rel="noopener">writeup</a></p>
</li>
<li><p><a href="https://stackoverflow.com/questions/11929701/why-is-seeding-the-random-generator-not-stable-between-versions-of-python" target="_blank" rel="noopener">Difference of dealing with str seed in older and new python version</a></p>
</li>
</ol>
<h3 id="4-Hidden-Painting"><a href="#4-Hidden-Painting" class="headerlink" title="4. Hidden Painting"></a>4. Hidden Painting</h3><p>Each line is a coordinate. Paint them and the image shows the flag. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> pyplot</span><br><span class="line"></span><br><span class="line">row=[]</span><br><span class="line">col=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"secret_map.txt"</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        row.append(line.split()[<span class="number">0</span>])</span><br><span class="line">        col.append(line.split()[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(row)):</span><br><span class="line">    row[i] = int(row[i],<span class="number">16</span>)</span><br><span class="line">    col[i] = int(col[i],<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">pic = np.zeros((max(row)+<span class="number">50</span>, max(col)+<span class="number">50</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># white background</span></span><br><span class="line">pic[<span class="number">0</span>:][<span class="number">0</span>:] =<span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(row)):</span><br><span class="line">    pic[row[i]][col[i]] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">               </span><br><span class="line">pyplot.imshow(pic,cmap=<span class="string">'gray'</span>)</span><br><span class="line">pyplot.savefig(<span class="string">'tang.png'</span>)</span><br><span class="line">pyplot.show()</span><br></pre></td></tr></table></figure>



</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">喝点儿聊聊</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://fromessence.github.io/public/2020/04/26/247CTF/">https://fromessence.github.io/public/2020/04/26/247CTF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/public/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/public/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/public/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/public/2020/05/03/TCP%E7%AB%AF%E5%8F%A3%E5%85%B1%E4%BA%AB%E9%97%AE%E9%A2%98/"><img class="prev_cover lazyload" data-src="/public/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">TCP端口“共享”问题</div></div></a></div><div class="next-post pull_right"><a href="/public/2020/04/11/%E5%86%B3%E7%AD%96%E6%A0%91/"><img class="next_cover lazyload" data-src="/public/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">决策树</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 喝点儿聊聊</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/public/js/utils.js"></script><script src="/public/js/main.js"></script><script src="/public/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>